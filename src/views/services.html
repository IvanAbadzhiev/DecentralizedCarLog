 <% include header %>
		<div class="jumbotron">
		  <h1 class="display-4">Add a car service</h1>
		  <p class="lead">If you are owner of car service you can participate in out system when you deposit 1 ether</p>
		  <hr class="my-4">
		  
		  <p>
		  	<div class="form-group">
			    <label for="name">Car service name : </label>
			    <input type="text" class="form-control" id="name" name="name" placeholder="Your Service ltd">
			    <span class="error"></span>
		  	</div>

		  	<div class="form-group">
			    <label>Service Image : </label>
			    <input type="file" class="form-control" id="serviceImage">
			    <input type="hidden" id="ipfsImage">
			    <span class="errorImage"></span>
		  	</div>

		  </p>
		  <p class="lead">
		    <input type="button" class="btn btn-primary btn-lg" id="addService" value="Add a service!">
		  </p>
		</div>
		

		<div class="row" id="serviceRow">
			<!-- here will be added all available services -->
		</div>
	</div>
	<script type="text/javascript">

	let contractAddress = '0xa9e22aff881eeb0455ba23e88b907afa72018680';
	let contractAbi = [{"constant":!0,"inputs":[],"name":"getServicesLength","outputs":[{"name":"","type":"uint256"}],"payable":!1,"stateMutability":"view","type":"function"},{"constant":!0,"inputs":[{"name":"index","type":"uint256"}],"name":"getService","outputs":[{"name":"","type":"address"},{"name":"","type":"string"},{"name":"","type":"string"}],"payable":!1,"stateMutability":"view","type":"function"},{"constant":!1,"inputs":[{"name":"name","type":"string"},{"name":"image","type":"string"}],"name":"addService","outputs":[],"payable":!0,"stateMutability":"payable","type":"function"},{"inputs":[],"payable":!1,"stateMutability":"nonpayable","type":"constructor"}];

	$("#serviceImage").on("change", function(){
		const reader = new FileReader();
		ipfsFileReader(reader, "serviceImage");
	});

    let contract = web3.eth.contract(contractAbi).at(contractAddress)

    function getServices(){
    	contract.getServicesLength(function(err, result){
    		let serviceLength = result.toNumber();

    		for (var i = 0; i < serviceLength; i++) {
    			contract.getService(i,function(err,result){
		    		if(!err){
		    			$("#serviceRow").text(''); //remove previous result
		    			let address = result[0];
		    			let name = result[1];
		    			let image = result[2];

		    			let html = '<div class="col-sm-6 col-md-4 col-lg-3">';
		    			html += '<div class="panel panel-default">';
		    			html += '<div class="panel-heading">';
		    			html += '<h3 class="panel-title">' + name + '</h3>';
		    			html += '</div>'

		    			html += '<div class="panel-body">';
		    			html += '<img class="img-rounded img-center" style="width: 100%;" src="' + image + '">';
		    			html += '<br/><br/>';
		    			html += '<strong>Address</strong>: <span class="address">' + address + '</span><br/>';			    				
			    		html += '</div>';
			    		html += '</div>';
			    		html += '</div>';

			    		$('#serviceRow').append(html);
		    		}
		    	});
    		}
    	});
    }

    function addService(name,image) {
    	contract.addService(name, image, { from : web3.eth.accounts[0], value :100 },
    			function(err, data){
    		//if(!err){ location.reload(); }
    	});
    }

    $("#addService").on("click", function(){
    	$(".error").text('');
    	let service_name = $("#name").val();

    	if(!service_name){
    		$(".error").text('Please write valid service name');
    		return;
    	} 

    	if(service_name.length < 3){
    		$(".error").text('Service name must be over 3 characters');
    		return;
    	}

    	let image = $("#ipfsImage").val();

    	if(!image){
    		$(".errorImage").text('Please add image of your car');
    	}
    	
    	addService(service_name,image);
    });

    
    
    $(document).ready(function(){
    	getServices();
    });
	</script>
 <% include footer %>